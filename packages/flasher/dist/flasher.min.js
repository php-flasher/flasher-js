!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).flasher=t()}(this,(function(){"use strict";class e{constructor(e){this.options={timeout:5e3,fps:30,position:"top-right",direction:"top",rtl:!1,style:{},darkMode:"media"},this.viewFactory=e}success(e,t,s){this.flash("success",e,t,s)}info(e,t,s){this.flash("info",e,t,s)}warning(e,t,s){this.flash("warning",e,t,s)}error(e,t,s){this.flash("error",e,t,s)}flash(e,t,s,r){const n=this.createNotification(e,t,s,r);this.renderOptions({}),this.render({notification:n})}createNotification(e,t,s,r){if("object"==typeof e?(e=(r=e).type,t=r.message,s=r.title):"object"==typeof t?(t=(r=t).message,s=r.title):"object"==typeof s&&(s=(r=s).title),void 0===t)throw new Error("message option is required");return{type:e||"info",message:t,title:s,options:r}}render(e){const{notification:t}=e,s=t.options||{},r=Array.isArray(s)?this.options:{...this.options,...s},n=()=>{const t=this.createContainer(r);this.addToContainer(t,e,r)};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",n):n()}renderOptions(e){this.options={...this.options,...e},this.applyDarkMode()}createContainer(e){const t=`.fl-main-container[data-position="${e.position}"]`;let s=document.querySelector(t);return s?(s.dataset.turboCache="false",s):(s=document.createElement("div"),s.classList.add("fl-main-container"),s.dataset.position=e.position,s.dataset.turboCache="false",Object.keys(e.style).forEach((t=>{s?.style.setProperty(t,e.style[t])})),document.body.append(s),s)}addToContainer(e,t,s){const r=this.stringToHTML(t.template||this.viewFactory.render(t));r.classList.add("fl-container"),this.appendNotification(e,r,s),this.renderProgressBar(r,s),this.handleClick(r)}appendNotification(e,t,s){"bottom"===s.direction?e.append(t):e.prepend(t),s.rtl&&t.classList.add("fl-rtl"),setTimeout((()=>{t.classList.add("fl-show")}),100)}removeNotification(e){const t=e.parentElement;e.classList.remove("fl-show"),e.addEventListener("transitionend",(()=>{e.remove(),t.hasChildNodes()||t.remove()}))}handleClick(e){e.addEventListener("click",(()=>this.removeNotification(e)))}renderProgressBar(e,t){if(!t.timeout||t.timeout<=0)return;const s=document.createElement("span");s.classList.add("fl-progress");const r=e.querySelector(".fl-progress-bar");r&&r.append(s);const n=1e3/t.fps;let i=0;const o=()=>{i+=1;const r=100*(1-n*(i/t.timeout));s.style.width=`${r}%`,r<=0&&(clearInterval(a),this.removeNotification(e))};let a=window.setInterval(o,n);e.addEventListener("mouseout",(()=>a=window.setInterval(o,n))),e.addEventListener("mouseover",(()=>clearInterval(a)))}applyDarkMode(){if(document.body.classList.contains("fl-dark-mode")||document.querySelector("style.flasher-js"))return;const[e,t=".dark"]=[].concat(this.options.darkMode);let s=".fl-main-container .fl-container.fl-flasher {background-color: rgb(15, 23, 42);color: rgb(255, 255, 255);}";s="media"===e?`@media (prefers-color-scheme: dark) {${s}}`:`${t} ${s}`;const r=document.createElement("style");r.type="text/css",r.classList.add("flasher-js"),r.appendChild(document.createTextNode(s)),document.head.appendChild(r),document.body.classList.add("fl-dark-mode")}stringToHTML(e){if((()=>{if(!DOMParser)return!1;const e=new DOMParser;try{e.parseFromString("x","text/html")}catch(e){return!1}return!0})()){return(new DOMParser).parseFromString(e,"text/html").body.firstChild}const t=document.createElement("div");return t.innerHTML=e,t.firstElementChild}}const t=new class{constructor(){this.defaultHandler="theme.flasher",this.factories=new Map,this.themes=new Map}success(e,t,s){this.flash("success",e,t,s)}info(e,t,s){this.flash("info",e,t,s)}warning(e,t,s){this.flash("warning",e,t,s)}error(e,t,s){this.flash("error",e,t,s)}flash(e,t,s,r){const n=this.createNotification(e,t,s,r),i=this.create(this.defaultHandler);i.renderOptions({}),i.render({notification:n})}createNotification(e,t,s,r){if("object"==typeof e?(e=(r=e).type,t=r.message,s=r.title):"object"==typeof t?(t=(r=t).message,s=r.title):"object"==typeof s&&(s=(r=s).title),void 0===t)throw new Error("message option is required");return{type:e||"info",message:t,title:s,options:r}}create(e){e=this.resolveHandler(e),this.resolveThemeHandler(e);const t=this.factories.get(e);if(!t)throw new Error(`Unable to resolve "${e}" notification factory, did you forget to register it?`);return t}renderOptions(e){Object.entries(e).forEach((([e,t])=>{this.create(e).renderOptions(t)}))}render(e){e=this.resolveResponse(e),this.addStyles(e.styles,(()=>{this.addScripts(e.scripts,(()=>{this.renderOptions(e.options),this.renderEnvelopes(e.envelopes,e.context)}))}))}addFactory(e,t){this.factories.set(e,t)}addTheme(e,t){this.themes.set(e,t)}using(e){return this.defaultHandler=e,this}addStyles(e,t){if(0===e.length)return void("function"==typeof t&&t());if(null!==document.querySelector(`link[href="${e[0]}"]`))return void this.addStyles(e.slice(1),t);const s=document.createElement("link");s.setAttribute("href",e[0]),s.setAttribute("type","text/css"),s.setAttribute("rel","stylesheet"),s.onload=()=>this.addStyles(e.slice(1),t),document.head.appendChild(s)}addScripts(e,t){if(0===e.length)return void("function"==typeof t&&t());if(null!==document.querySelector(`script[src="${e[0]}"]`))return void this.addScripts(e.slice(1),t);const s=document.createElement("script");s.setAttribute("src",e[0]),s.setAttribute("type","text/javascript"),s.onload=()=>this.addScripts(e.slice(1),t),document.head.appendChild(s)}renderEnvelopes(e,t){const s=new Map;e.forEach((e=>{e.context={...e.context,...t},e.handler=this.resolveHandler(e.handler);const r=this.create(e.handler);this.isQueueable(r)?(s.get(e.handler)||r.resetQueue(),r.addEnvelope(e),s.set(e.handler,r)):r.render(e)})),s.forEach((e=>e.renderQueue()))}isQueueable(e){return"function"==typeof e.addEnvelope&&"function"==typeof e.renderQueue}resolveResponse(e){return e.envelopes=e.envelopes||[],e.options=e.options||{},e.scripts=e.scripts||[],e.styles=e.styles||[],e.context=e.context||{},Object.entries(e.options).forEach((([t,s])=>{e.options[t]=this.parseOptions(s)})),e.envelopes.forEach((t=>{t.handler=this.resolveHandler(t.handler),t.notification.options=this.parseOptions(t.notification.options||{}),this.pushStyles(e,t.handler)})),e}parseOptions(e){return Object.entries(e).forEach((([t,s])=>{e[t]=this.parseFunction(s)})),e}parseFunction(e){if("string"!=typeof e)return e;const t=e.match(/^function(?:.+)?(?:\s+)?\((.+)?\)(?:\s+|\n+)?{(?:\s+|\n+)?((?:.|\n)+)}$/m);if(!t)return e;const s=t[1]?.split(",").map((e=>e.trim()))??[],r=t[2];return new Function(...s,r)}pushStyles(e,t){t=t.replace("theme.","");const s=this.themes.get(t)?.styles||[];e.styles=Array.from(new Set([...e.styles,...s]))}resolveHandler(e){return e=e||this.defaultHandler,["flasher","theme","template"].includes(e)&&(e="theme.flasher"),e=e.replace("template.","theme.")}resolveThemeHandler(t){if(this.factories.get(t))return;if(0!==t.indexOf("theme."))return;const s=this.themes.get(t.replace("theme.",""));s&&this.addFactory(t,new e(s))}};return t.addTheme("flasher",{render:e=>{const t=e.notification;return'<div class="fl-flasher fl-'+t.type+'"><div class="fl-content"><div class="fl-icon"></div><div><strong class="fl-title">'+(t.title??t.type)+'</strong><span class="fl-message">'+t.message+'</span></div></div><span class="fl-progress-bar"></span></div>'}}),t}));
