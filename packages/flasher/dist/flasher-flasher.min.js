!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).flasher=t()}(this,(function(){"use strict";class e{constructor(e){this.options={timeout:5e3,fps:30,position:"top-right",direction:"top",rtl:!1,style:{},darkMode:"media"},this.viewFactory=e}success(e,t,s){this.flash("success",e,t,s)}info(e,t,s){this.flash("info",e,t,s)}warning(e,t,s){this.flash("warning",e,t,s)}error(e,t,s){this.flash("error",e,t,s)}flash(e,t,s,n){const r=this.createNotification(e,t,s,n);this.renderOptions({}),this.render({notification:r})}createNotification(e,t,s,n){if("object"==typeof e?(e=(n=e).type,t=n.message,s=n.title):"object"==typeof t?(t=(n=t).message,s=n.title):"object"==typeof s&&(s=(n=s).title),void 0===t)throw new Error("message option is required");return{type:e||"info",message:t,title:s,options:n}}render(e){const{notification:t}=e,s=t.options||{},n=Array.isArray(s)?this.options:Object.assign(Object.assign({},this.options),s),r=()=>{const t=this.createContainer(n);this.addToContainer(t,e,n)};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",r):r()}renderOptions(e){this.options=Object.assign(Object.assign({},this.options),e),this.applyDarkMode()}createContainer(e){const t=`.fl-main-container[data-position="${e.position}"]`;let s=document.querySelector(t);return s?(s.dataset.turboCache="false",s):(s=document.createElement("div"),s.classList.add("fl-main-container"),s.dataset.position=e.position,s.dataset.turboCache="false",Object.keys(e.style).forEach((t=>{null==s||s.style.setProperty(t,e.style[t])})),document.body.append(s),s)}addToContainer(e,t,s){const n=this.stringToHTML(t.template||this.viewFactory.render(t));n.classList.add("fl-container"),this.appendNotification(e,n,s),this.renderProgressBar(n,s),this.handleClick(n)}appendNotification(e,t,s){"bottom"===s.direction?e.append(t):e.prepend(t),s.rtl&&t.classList.add("fl-rtl"),setTimeout((()=>{t.classList.add("fl-show")}),100)}removeNotification(e){const t=e.parentElement;e.classList.remove("fl-show"),e.addEventListener("transitionend",(()=>{e.remove(),t.hasChildNodes()||t.remove()}))}handleClick(e){e.addEventListener("click",(()=>this.removeNotification(e)))}renderProgressBar(e,t){if(!t.timeout||t.timeout<=0)return;const s=document.createElement("span");s.classList.add("fl-progress");const n=e.querySelector(".fl-progress-bar");n&&n.append(s);const r=1e3/t.fps;let i=0;const o=()=>{i+=1;const n=100*(1-r*(i/t.timeout));s.style.width=`${n}%`,n<=0&&(clearInterval(a),this.removeNotification(e))};let a=window.setInterval(o,r);e.addEventListener("mouseout",(()=>a=window.setInterval(o,r))),e.addEventListener("mouseover",(()=>clearInterval(a)))}applyDarkMode(){if(document.body.classList.contains("fl-dark-mode")||document.querySelector("style.flasher-js"))return;const[e,t=".dark"]=[].concat(this.options.darkMode);let s=".fl-main-container .fl-container.fl-flasher {background-color: rgb(15, 23, 42);color: rgb(255, 255, 255);}";s="media"===e?`@media (prefers-color-scheme: dark) {${s}}`:`${t} ${s}`;const n=document.createElement("style");n.type="text/css",n.classList.add("flasher-js"),n.appendChild(document.createTextNode(s)),document.head.appendChild(n),document.body.classList.add("fl-dark-mode")}stringToHTML(e){if((()=>{if(!DOMParser)return!1;const e=new DOMParser;try{e.parseFromString("x","text/html")}catch(e){return!1}return!0})()){return(new DOMParser).parseFromString(e,"text/html").body.firstChild}const t=document.createElement("div");return t.innerHTML=e,t.firstElementChild}}const t=new class{constructor(){this.defaultHandler="theme.flasher",this.factories=new Map,this.themes=new Map}success(e,t,s){this.flash("success",e,t,s)}info(e,t,s){this.flash("info",e,t,s)}warning(e,t,s){this.flash("warning",e,t,s)}error(e,t,s){this.flash("error",e,t,s)}flash(e,t,s,n){const r=this.createNotification(e,t,s,n),i=this.create(this.defaultHandler);i.renderOptions({}),i.render({notification:r})}createNotification(e,t,s,n){if("object"==typeof e?(e=(n=e).type,t=n.message,s=n.title):"object"==typeof t?(t=(n=t).message,s=n.title):"object"==typeof s&&(s=(n=s).title),void 0===t)throw new Error("message option is required");return{type:e||"info",message:t,title:s,options:n}}create(e){e=this.resolveHandler(e),this.resolveThemeHandler(e);const t=this.factories.get(e);if(!t)throw new Error(`Unable to resolve "${e}" notification factory, did you forget to register it?`);return t}renderOptions(e){Object.entries(e).forEach((([e,t])=>{this.create(e).renderOptions(t)}))}render(e){e=this.resolveResponse(e),this.addStyles(e.styles,(()=>{this.addScripts(e.scripts,(()=>{this.renderOptions(e.options),this.renderEnvelopes(e.envelopes,e.context)}))}))}addFactory(e,t){this.factories.set(e,t)}addTheme(e,t){this.themes.set(e,t)}using(e){return this.defaultHandler=e,this}addStyles(e,t){if(0===e.length)return void("function"==typeof t&&t());if(null!==document.querySelector(`link[href="${e[0]}"]`))return void this.addStyles(e.slice(1),t);const s=document.createElement("link");s.setAttribute("href",e[0]),s.setAttribute("type","text/css"),s.setAttribute("rel","stylesheet"),s.onload=()=>this.addStyles(e.slice(1),t),document.head.appendChild(s)}addScripts(e,t){if(0===e.length)return void("function"==typeof t&&t());if(null!==document.querySelector(`script[src="${e[0]}"]`))return void this.addScripts(e.slice(1),t);const s=document.createElement("script");s.setAttribute("src",e[0]),s.setAttribute("type","text/javascript"),s.onload=()=>this.addScripts(e.slice(1),t),document.head.appendChild(s)}renderEnvelopes(e,t){const s=new Map;e.forEach((e=>{e.context=Object.assign(Object.assign({},e.context),t),e.handler=this.resolveHandler(e.handler);const n=this.create(e.handler);this.isQueueable(n)?(s.get(e.handler)||n.resetQueue(),n.addEnvelope(e),s.set(e.handler,n)):n.render(e)})),s.forEach((e=>e.renderQueue()))}isQueueable(e){return"function"==typeof e.addEnvelope&&"function"==typeof e.renderQueue}resolveResponse(e){return e.envelopes=e.envelopes||[],e.options=e.options||{},e.scripts=e.scripts||[],e.styles=e.styles||[],e.context=e.context||{},Object.entries(e.options).forEach((([t,s])=>{e.options[t]=this.parseOptions(s)})),e.envelopes.forEach((t=>{t.handler=this.resolveHandler(t.handler),t.notification.options=this.parseOptions(t.notification.options||{}),this.pushStyles(e,t.handler)})),e}parseOptions(e){return Object.entries(e).forEach((([t,s])=>{e[t]=this.parseFunction(s)})),e}parseFunction(e){var t,s;if("string"!=typeof e)return e;const n=e.match(/^function(?:.+)?(?:\s+)?\((.+)?\)(?:\s+|\n+)?{(?:\s+|\n+)?((?:.|\n)+)}$/m);if(!n)return e;const r=null!==(s=null===(t=n[1])||void 0===t?void 0:t.split(",").map((e=>e.trim())))&&void 0!==s?s:[],i=n[2];return new Function(...r,i)}pushStyles(e,t){var s;t=t.replace("theme.","");const n=(null===(s=this.themes.get(t))||void 0===s?void 0:s.styles)||[];e.styles=Array.from(new Set([...e.styles,...n]))}resolveHandler(e){return e=e||this.defaultHandler,["flasher","theme","template"].includes(e)&&(e="theme.flasher"),e=e.replace("template.","theme.")}resolveThemeHandler(t){if(this.factories.get(t))return;if(0!==t.indexOf("theme."))return;const s=this.themes.get(t.replace("theme.",""));s&&this.addFactory(t,new e(s))}};return t.addTheme("flasher",{render:e=>{var t;const s=e.notification;return'<div class="fl-flasher fl-'+s.type+'"><div class="fl-content"><div class="fl-icon"></div><div><strong class="fl-title">'+(null!==(t=s.title)&&void 0!==t?t:s.type)+'</strong><span class="fl-message">'+s.message+'</span></div></div><span class="fl-progress-bar"></span></div>'}}),t}));
